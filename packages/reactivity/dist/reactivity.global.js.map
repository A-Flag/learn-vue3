{
  "version": 3,
  "sources": ["../src/index.ts", "../../shared/src/index.ts", "../src/effect.ts", "../src/baseHandler.ts", "../src/reactive.ts"],
  "sourcesContent": ["import {isObject} from '@vue/shared'\n\n// console.log(isObject(true))\n\nconsole.log(isObject({}),'33')\nconsole.log(isObject(true),'22')\nexport {effect} from './effect' \nexport {reactive} from './reactive'", "export const isObject =(value)=>{\n    return typeof value ==='object' && value !== null;\n}", "\nexport let activeEffect = undefined\nclass ReactiveEffect {\n    public parent = null;\n    public deps =[]\n\n    //\u8FD9\u91CC\u8868\u793A\u5728\u5B9E\u4F8B\u4E0A\u65B0\u589E\u4E86active\u5C5E\u6027\n    public active=true;//\u8FD9\u4E2Aeffect\u9ED8\u8BA4\u662F\u6FC0\u6D3B\u72B6\u6001\n    constructor(public fn){//\u7528\u6237\u4F20\u9012\u7684\u53C2\u6570\u4E5F\u4F1A\u653E\u5230this\u4E0A\uFF1Athis.fn = fn\n\n    }\n    run(){//\u6267\u884Ceffect\n        if(!this.active){\n            this.fn();//\u8FD9\u91CC\u8868\u793A\u5982\u679C\u662F\u975E\u6FC0\u6D3B\u60C5\u51B5\uFF0C\u53EA\u9700\u8981\u6267\u884C\u51FD\u6570\uFF0C\u4E0D\u9700\u8981\u8FDB\u884C\u4F9D\u8D56\u6536\u96C6\n        }\n\n        //\u8FD9\u91CC\u8981\u4F9D\u8D56\u6536\u96C6\uFF0C\u6838\u5FC3\u5C31\u662F\u5C06\u5F53\u524D\u7684effect\u548C\u7A0D\u540E\u6E32\u67D3\u7684\u5C5E\u6027\u5173\u8054\u5728\u4E00\u8D77,\u5C31\u662F\u8D4B\u503C\uFF08let activeEffect = undefined\uFF09\n       try{\n            this.parent = activeEffect;\n            activeEffect = this;\n            return this.fn()//\u5F53\u7A0D\u540E\u8C03\u7528\u53D6\u503C\u64CD\u4F5C\u7684\u65F6\u5019\uFF0C\u5C31\u53EF\u4EE5\u83B7\u53D6\u5230\u8FD9\u4E2A\u5168\u5C40\u7684activeEffect\u4E86\n       }finally{\n            activeEffect = this.parent;\n            this.parent = null;\n\n       }\n    }\n}\n\nexport function effect(fn){\n    //\u8FD9\u91CCfn,\u53EF\u4EE5\u6839\u636E\u72B6\u6001\u53D8\u5316\uFF0C\u91CD\u65B0\u6267\u884C\uFF0Ceffect\u53EF\u4EE5\u5D4C\u5957\u7740\u5199\n\n   const _effect= new ReactiveEffect(fn);\n   _effect.run()//\u9ED8\u8BA4\u5148\u6267\u884C\u4E00\u6B21\n}\n\n//\u4E00\u4E2Aeffect\u5BF9\u5E94\u591A\u4E2A\u5C5E\u6027\uFF0C\u4E00\u4E2A\u5C5E\u6027\u5BF9\u5E94\u591A\u4E2Aeffect\nconst targetMap = new WeakMap()\nexport function track(target,type,key){//\u6A21\u7248\u4E2D\u6CA1\u6709\u7528\u5230\u7684\u5C5E\u6027\u662F\u4E0D\u4F1A\u88AB\u8DDF\u8E2A\u7684\n    debugger\n    if(!activeEffect) return\n    let depsMap = targetMap.get(target);  //\u7B2C\u4E00\u6B21\u6CA1\u6709\n    if(!depsMap){\n        targetMap.set(target,(depsMap= new Map()))\n    }\n    let dep = depsMap.get(key)\n    if(!dep){\n        depsMap.set(key,(dep=new Set()))\n    }\n    let shouldTrack = !dep.has(activeEffect)//\u53BB\u91CD\u4E86\n    if(shouldTrack){\n        dep.add(activeEffect)\n        // name:new Set() deps\u5B58effects\n        activeEffect.deps.push(dep)//\u8BA9effect\u8BB0\u5F55\u5BF9\u5E94\u7684key\n    }\n//\u5355\u5411\u7684\u6307\u7684\u662F\uFF0C\u5C5E\u6027\u8BB0\u5F55\u4E86effect,\u5E94\u8BE5\u8BA9effect\u4E5F\u8BB0\u5F55\u5B83\u88AB\u90A3\u4E9B\u5C5E\u6027\u6536\u96C6\u8FC7\n\n\n//\u5BF9\u8C61 \u67D0\u4E2A\u5C5E\u6027 -\u300B\u591A\u4E2Aeffect\n//weakMap ={\u5BF9\u8C61:Map{name:Set}}\n//{\u5BF9\u8C61:{name:[]}}\n\n}\n\n//\u8FD9\u4E2A\u6267\u884C\u6D41\u7A0B \u5C31\u7C7B\u4F3C\u4E8E\u4E00\u4E2A\u6811\u5F62\u7ED3\u6784\n\n//\u3010e1\uFF0Ce2\u3011---\u6267\u884Ce2\u540E\u5220\u9664e2 \u8FDB\u6808\u51FA\u6808---\n\n// effect(()=>{//e1   //parent = null;   activeEffect=e1 ---\u6807\u8BB0\n    //state.name //name--e1\n//     effect(()=>{//e2 //parent = e1;   activeEffect=e2\n  //state.age //age--e2\n//     })\n  //state.address //? activeEffect--e1 // activeEffect = this.parent\n// })\n\nexport function trigger(target,type,key,value,oldValue){\n    const depsMap = targetMap.get(target)\n    if(!depsMap)return;//\u7684\u3001\u89E6\u53D1\u7684\u503C\u4E0D\u5728\u6A21\u7248\u4E2D\n    \n    const effects = depsMap.get(key);//\u627E\u5230\u4E86\u5C5E\u6027\u5BF9\u5E94\u7684effect\n    effects && effects.forEach((effect)=>{\n        //\u5728\u6267\u884Ceffecct\u7684\u65F6\u5019\uFF0C\u53C8\u8981\u6267\u884C\u81EA\u5DF1\uFF0C\u90A3\u6211\u4EEC\u8981\u5C4F\u853D\uFF0C\u4E0D\u8981\u65E0\u9650\u8C03\u7528\n        if(effect !== activeEffect) effect.run()\n        \n    })\n\n\n}\n\n//1) \u5148\u521B\u5EFA\u4E00\u4E2A\u54CD\u5E94\u5F0F\u5BF9\u8C61 new Proxy\n//2) effect \u9ED8\u8BA4\u6570\u636E\u53D8\u5316\u8981\u6267\u884C\u80FD\u66F4\u65B0\uFF08\u628A\u6570\u636E\u548C\u51FD\u6570\u5173\u8054\u8D77\u6765\uFF09\uFF0C\u5148\u5C06\u6B63\u5728\u6267\u884C\u7684effect\u4F5C\u4E3A\u5168\u5C40\u53D8\u91CF\uFF0C\n//\u6E32\u67D3\uFF08\u53D6\u503C\uFF09\uFF0C\u5728get\u65B9\u6CD5\u4E2D\u8FDB\u884C\u4F9D\u8D56\u6536\u96C6\n//3\uFF09\u4F9D\u8D56\u6536\u96C6\u8FC7\u7A0B\u7ED3\u6784\uFF1Aweakmap(\u5BF9\u8C61\uFF1Amap(\u5C5E\u6027:set(effect)))\n//4)\u7A0D\u540E\u7528\u6237\u53D1\u751F\u6570\u636E\u53D8\u5316\uFF0C\u4F1A\u901A\u8FC7\u5BF9\u8C61\u5C5E\u6027\u6765\u67E5\u627E\u5BF9\u5E94\u7684effect\u96C6\u5408\uFF0C\u627E\u5230effect\u5168\u90E8\u6267\u884C\n\n\n\n//watch api/computed/\u7EC4\u4EF6\u57FA\u4E8Eeffect   ----vue2 watcher \u6CA1\u6709\u533A\u522B", "import { activeEffect, track } from \"./effect\"\nexport const enum ReactiveFlags{\n    IS_REACTIVE = '__v_isReactive'\n}\nexport const mutableHandlers={\n    //\u53EF\u4EE5\u76D1\u63A7\u5230\u7528\u6237\u53D6\u503C\u4E86\n    get(target,key,reactiver){//reactiver \u5C31\u662F\u4EE3\u7406\u5BF9\u8C61\n        console.log('reactiver==',reactiver,'target',target)\n        if(key===ReactiveFlags.IS_REACTIVE){\n            return true\n        }\n        track(target,'get',key)\n        // return target[key];\n        return Reflect.get(target,key,reactiver)//Reflect\u6539\u53D8\u4E86\u53D6\u503C\u7684\u65F6\u5019this\u7684\u6307\u5411\n    },\n    set(target,key,value,reactiver){\n        // target[key] = value;\n        //\u53EF\u4EE5\u76D1\u63A7\u5230\u7528\u6237\u8BBE\u503C\u4E86\n        return Reflect.set(target,key,value,reactiver);\n    }\n}", "import { isObject } from \"@vue/shared\";\nimport {mutableHandlers,ReactiveFlags} from './baseHandler'\n\n//\u5C06\u6570\u636E\u8F6C\u5316\u4E3A\u54CD\u5E94\u5F0F\u6570\u636E,\u53EA\u80FD\u505A\u5BF9\u8C61\u4EE3\u7406\n\nlet reactiveMap = new WeakMap();//key\u53EA\u80FD\u662F\u5BF9\u8C61\n\n//\u5B9E\u73B0\u540C\u4E00\u4E2A\u5BF9\u8C61 \u4EE3\u7406\u591A\u6B21\uFF0C\u8FD4\u56DE\u4E00\u4E2A\u5BF9\u8C61\n//\u4EE3\u7406\u5BF9\u8C61\u518D\u6B21\u4EE3\u7406\uFF0C\u53EF\u4EE5\u76F4\u63A5\u8FD4\u56DE\nexport function reactive(target){\n    if(!isObject(target)){\n        return\n    }\n    if(target[ReactiveFlags.IS_REACTIVE]){\n        return target\n    }\n    //test\n    // let target1 = {\n    //     name:'lala',\n    //     get lala(){\n    //         return this.name\n    //     }\n    // }\n    // target1.lala\n    //proxy.lala \u53EA\u6267\u884C\u4E00\u6B21\uFF0C\u5E94\u8BE5\u8D702\u6B21(1\u6B21\u53D6\u4E0D\u5230name\u4E3Alala)\n    //\u6211\u5728\u9875\u9762\u4E2D\u4F7F\u7528\u4E86lala\u5BF9\u5E94\u7684\u503C\uFF0C\u7A0D\u540Ename\u53D8\u5316\u4E86\uFF0C\u8981\u91CD\u65B0\u6E32\u67D3\n    //\u5E76\u6CA1\u6709\u91CD\u65B0\u5B9A\u4E49\u5C5E\u6027\uFF0C\u53EA\u662F\u4EE3\u7406\uFF0C\u5728\u53D6\u503C\u7684\u65F6\u5019\u4F1A\u8C03\u7528get,\u5F53\u8D4B\u503C\u7684\u65F6\u5019\u8C03\u7528set\n\n    let existitignProxy = reactiveMap.get(target)//\u7F13\u5B58\u673A\u5236\uFF0C\u5BF9\u8C61\u76F8\u7B49\u7684\u65F6\u5019\u4F7F\u7528\u7F13\u5B58\n    if(existitignProxy){\n        return existitignProxy\n    }\n\n    //\u7B2C\u4E00\u6B21\u666E\u901A\u5BF9\u8C61\u4EE3\u7406\uFF0C\u6211\u4EEC\u4F1A\u901A\u8FC7new Proxy\u4EE3\u7406\u4E00\u6B21\n    //\u4E0B\u4E00\u6B21\u4F60\u4F20\u9012\u7684\u662Fproxy\uFF0C\u6211\u4EEC\u53EF\u4EE5\u770B\u4E00\u4E0B\u5B83\u6709\u6CA1\u6709\u4EE3\u7406\u8FC7\uFF0C\u5982\u6709\u8BBF\u95EE\u8FC7proxy\u7684get\u65B9\u6CD5\uFF0C\u8BF4\u660E\u8BBF\u95EE\u8FC7\n    const proxy = new Proxy(target,mutableHandlers)\n    reactiveMap.set(target,proxy);\n    return proxy\n}"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;;;ACAO,MAAM,WAAU,CAAC,UAAQ;AAC5B,WAAO,OAAO,UAAS,YAAY,UAAU;AAAA,EACjD;;;ACDO,MAAI,eAAe;AAC1B,MAAM,iBAAN,MAAqB;AAAA,IAMjB,YAAmB,IAAG;AAAH;AALnB,WAAO,SAAS;AAChB,WAAO,OAAM,CAAC;AAGd,WAAO,SAAO;AAAA,IAGd;AAAA,IACA,MAAK;AACD,UAAG,CAAC,KAAK,QAAO;AACZ,aAAK,GAAG;AAAA,MACZ;AAGD,UAAG;AACE,aAAK,SAAS;AACd,uBAAe;AACf,eAAO,KAAK,GAAG;AAAA,MACpB,UAAC;AACI,uBAAe,KAAK;AACpB,aAAK,SAAS;AAAA,MAEnB;AAAA,IACH;AAAA,EACJ;AAEO,WAAS,OAAO,IAAG;AAGvB,UAAM,UAAS,IAAI,eAAe,EAAE;AACpC,YAAQ,IAAI;AAAA,EACf;AAGA,MAAM,YAAY,oBAAI,QAAQ;AACvB,WAAS,MAAM,QAAO,MAAK,KAAI;AAClC;AACA,QAAG,CAAC;AAAc;AAClB,QAAI,UAAU,UAAU,IAAI,MAAM;AAClC,QAAG,CAAC,SAAQ;AACR,gBAAU,IAAI,QAAQ,UAAS,oBAAI,IAAI,CAAE;AAAA,IAC7C;AACA,QAAI,MAAM,QAAQ,IAAI,GAAG;AACzB,QAAG,CAAC,KAAI;AACJ,cAAQ,IAAI,KAAK,MAAI,oBAAI,IAAI,CAAE;AAAA,IACnC;AACA,QAAI,cAAc,CAAC,IAAI,IAAI,YAAY;AACvC,QAAG,aAAY;AACX,UAAI,IAAI,YAAY;AAEpB,mBAAa,KAAK,KAAK,GAAG;AAAA,IAC9B;AAAA,EAQJ;;;AC1DO,MAAM,kBAAgB;AAAA,IAEzB,IAAI,QAAO,KAAI,WAAU;AACrB,cAAQ,IAAI,eAAc,WAAU,UAAS,MAAM;AACnD,UAAG,QAAM,oCAA0B;AAC/B,eAAO;AAAA,MACX;AACA,YAAM,QAAO,OAAM,GAAG;AAEtB,aAAO,QAAQ,IAAI,QAAO,KAAI,SAAS;AAAA,IAC3C;AAAA,IACA,IAAI,QAAO,KAAI,OAAM,WAAU;AAG3B,aAAO,QAAQ,IAAI,QAAO,KAAI,OAAM,SAAS;AAAA,IACjD;AAAA,EACJ;;;ACfA,MAAI,cAAc,oBAAI,QAAQ;AAIvB,WAAS,SAAS,QAAO;AAC5B,QAAG,CAAC,SAAS,MAAM,GAAE;AACjB;AAAA,IACJ;AACA,QAAG,4CAAkC;AACjC,aAAO;AAAA,IACX;AAaA,QAAI,kBAAkB,YAAY,IAAI,MAAM;AAC5C,QAAG,iBAAgB;AACf,aAAO;AAAA,IACX;AAIA,UAAM,QAAQ,IAAI,MAAM,QAAO,eAAe;AAC9C,gBAAY,IAAI,QAAO,KAAK;AAC5B,WAAO;AAAA,EACX;;;AJlCA,UAAQ,IAAI,SAAS,CAAC,CAAC,GAAE,IAAI;AAC7B,UAAQ,IAAI,SAAS,IAAI,GAAE,IAAI;",
  "names": []
}
